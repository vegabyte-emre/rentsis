<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SuperAdmin Panel - Kurumsal Rent A Car</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, -apple-system, sans-serif; background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%); min-height: 100vh; color: #fff; }
        
        /* Login Page */
        .login-container { display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; }
        .login-box { background: rgba(30, 41, 59, 0.8); border: 1px solid #334155; border-radius: 16px; padding: 40px; width: 100%; max-width: 400px; }
        .login-logo { text-align: center; margin-bottom: 32px; }
        .login-logo-icon { width: 64px; height: 64px; background: linear-gradient(135deg, #7c3aed, #ec4899); border-radius: 16px; display: inline-flex; align-items: center; justify-content: center; font-size: 32px; margin-bottom: 16px; }
        .login-title { font-size: 24px; font-weight: bold; }
        .login-subtitle { color: #94a3b8; font-size: 14px; margin-top: 4px; }
        
        /* Form Elements */
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; color: #94a3b8; font-size: 14px; margin-bottom: 8px; }
        .form-input { width: 100%; padding: 12px 16px; background: rgba(15, 23, 42, 0.8); border: 1px solid #334155; border-radius: 8px; color: #fff; font-size: 14px; outline: none; transition: border-color 0.2s; }
        .form-input:focus { border-color: #7c3aed; }
        .form-input::placeholder { color: #64748b; }
        
        /* Buttons */
        .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 12px 24px; border-radius: 8px; font-weight: 500; text-decoration: none; transition: all 0.2s; cursor: pointer; border: none; font-size: 14px; }
        .btn-primary { background: linear-gradient(135deg, #7c3aed, #ec4899); color: #fff; width: 100%; }
        .btn-primary:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn-secondary { background: rgba(51, 65, 85, 0.5); border: 1px solid #475569; color: #fff; }
        .btn-secondary:hover { background: rgba(71, 85, 105, 0.5); }
        .btn-success { background: #22c55e; color: #fff; }
        .btn-danger { background: #ef4444; color: #fff; }
        .btn-sm { padding: 8px 16px; font-size: 12px; }
        
        /* Layout */
        .app-container { display: none; }
        .app-container.active { display: flex; min-height: 100vh; }
        .sidebar { width: 260px; background: rgba(15, 23, 42, 0.95); border-right: 1px solid #334155; padding: 20px; position: fixed; height: 100vh; overflow-y: auto; }
        .main-content { flex: 1; margin-left: 260px; padding: 24px; }
        
        /* Sidebar */
        .sidebar-logo { display: flex; align-items: center; gap: 12px; padding-bottom: 24px; border-bottom: 1px solid #334155; margin-bottom: 24px; }
        .sidebar-logo-icon { width: 40px; height: 40px; background: linear-gradient(135deg, #7c3aed, #ec4899); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .sidebar-logo-text { font-size: 18px; font-weight: bold; }
        .sidebar-logo-text span { color: #a78bfa; }
        .sidebar-menu { list-style: none; }
        .sidebar-menu li { margin-bottom: 4px; }
        .sidebar-menu a { display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-radius: 8px; color: #94a3b8; text-decoration: none; transition: all 0.2s; }
        .sidebar-menu a:hover, .sidebar-menu a.active { background: rgba(124, 58, 237, 0.2); color: #fff; }
        .sidebar-menu a.active { border-left: 3px solid #7c3aed; }
        .sidebar-footer { position: absolute; bottom: 20px; left: 20px; right: 20px; }
        .user-info { display: flex; align-items: center; gap: 12px; padding: 12px; background: rgba(30, 41, 59, 0.5); border-radius: 8px; }
        .user-avatar { width: 40px; height: 40px; background: linear-gradient(135deg, #7c3aed, #ec4899); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        .user-name { font-size: 14px; font-weight: 500; }
        .user-role { font-size: 12px; color: #a78bfa; }
        
        /* Header */
        .page-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .page-title { font-size: 28px; font-weight: bold; }
        .page-subtitle { color: #94a3b8; font-size: 14px; margin-top: 4px; }
        
        /* Stats Cards */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 32px; }
        .stat-card { background: rgba(30, 41, 59, 0.5); border: 1px solid #334155; border-radius: 16px; padding: 24px; transition: all 0.2s; }
        .stat-card:hover { border-color: #7c3aed; transform: translateY(-2px); }
        .stat-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 12px; }
        .stat-title { color: #94a3b8; font-size: 14px; }
        .stat-icon { width: 48px; height: 48px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 24px; }
        .stat-value { font-size: 36px; font-weight: bold; }
        .stat-desc { color: #64748b; font-size: 12px; margin-top: 4px; }
        .purple-bg { background: linear-gradient(135deg, rgba(124,58,237,0.2), rgba(236,72,153,0.2)); }
        .green-bg { background: linear-gradient(135deg, rgba(34,197,94,0.2), rgba(16,185,129,0.2)); }
        .blue-bg { background: linear-gradient(135deg, rgba(59,130,246,0.2), rgba(6,182,212,0.2)); }
        .yellow-bg { background: linear-gradient(135deg, rgba(234,179,8,0.2), rgba(249,115,22,0.2)); }
        
        /* Cards */
        .card { background: rgba(30, 41, 59, 0.5); border: 1px solid #334155; border-radius: 16px; padding: 24px; margin-bottom: 24px; }
        .card-title { font-size: 18px; font-weight: 600; margin-bottom: 16px; display: flex; align-items: center; gap: 8px; }
        
        /* Table */
        .table-container { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 16px; text-align: left; border-bottom: 1px solid #334155; }
        th { color: #94a3b8; font-weight: 500; font-size: 14px; }
        tr:hover { background: rgba(124, 58, 237, 0.1); }
        
        /* Badge */
        .badge { display: inline-flex; align-items: center; padding: 4px 12px; border-radius: 20px; font-size: 12px; font-weight: 500; }
        .badge-success { background: rgba(34, 197, 94, 0.2); color: #22c55e; }
        .badge-warning { background: rgba(234, 179, 8, 0.2); color: #eab308; }
        .badge-danger { background: rgba(239, 68, 68, 0.2); color: #ef4444; }
        .badge-info { background: rgba(59, 130, 246, 0.2); color: #3b82f6; }
        
        /* Modal */
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 1000; justify-content: center; align-items: center; padding: 20px; }
        .modal-overlay.active { display: flex; }
        .modal { background: #1e293b; border: 1px solid #334155; border-radius: 16px; width: 100%; max-width: 500px; max-height: 90vh; overflow-y: auto; }
        .modal-header { display: flex; justify-content: space-between; align-items: center; padding: 20px 24px; border-bottom: 1px solid #334155; }
        .modal-title { font-size: 18px; font-weight: 600; }
        .modal-close { background: none; border: none; color: #94a3b8; font-size: 24px; cursor: pointer; }
        .modal-body { padding: 24px; }
        .modal-footer { display: flex; justify-content: flex-end; gap: 12px; padding: 20px 24px; border-top: 1px solid #334155; }
        
        /* Pages */
        .page { display: none; }
        .page.active { display: block; }
        
        /* Toast */
        .toast-container { position: fixed; top: 20px; right: 20px; z-index: 2000; }
        .toast { background: #1e293b; border: 1px solid #334155; border-radius: 8px; padding: 16px 20px; margin-bottom: 10px; display: flex; align-items: center; gap: 12px; animation: slideIn 0.3s ease; }
        .toast-success { border-color: #22c55e; }
        .toast-error { border-color: #ef4444; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        
        /* Status Indicator */
        .status-dot { width: 8px; height: 8px; border-radius: 50%; display: inline-block; margin-right: 8px; }
        .status-dot.active { background: #22c55e; animation: pulse 2s infinite; }
        .status-dot.inactive { background: #ef4444; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        
        /* Company Card */
        .company-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; }
        .company-card { background: rgba(30, 41, 59, 0.5); border: 1px solid #334155; border-radius: 16px; padding: 20px; }
        .company-header { display: flex; justify-content: space-between; align-items: start; margin-bottom: 16px; }
        .company-name { font-size: 18px; font-weight: 600; }
        .company-code { color: #94a3b8; font-size: 12px; font-family: monospace; }
        .company-stats { display: flex; gap: 16px; margin: 16px 0; }
        .company-stat { text-align: center; }
        .company-stat-value { font-size: 20px; font-weight: bold; }
        .company-stat-label { font-size: 12px; color: #94a3b8; }
        .company-actions { display: flex; gap: 8px; margin-top: 16px; padding-top: 16px; border-top: 1px solid #334155; }
        
        /* Responsive */
        @media (max-width: 768px) {
            .sidebar { width: 100%; height: auto; position: relative; }
            .main-content { margin-left: 0; }
            .app-container.active { flex-direction: column; }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div class="login-container" id="loginPage">
        <div class="login-box">
            <div class="login-logo">
                <div class="login-logo-icon">üõ°Ô∏è</div>
                <div class="login-title">SuperAdmin Panel</div>
                <div class="login-subtitle">Kurumsal Rent A Car Platform Y√∂netimi</div>
            </div>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">E-posta</label>
                    <input type="email" class="form-input" id="loginEmail" placeholder="admin@example.com" value="admin@superadmin.com">
                </div>
                <div class="form-group">
                    <label class="form-label">≈ûifre</label>
                    <input type="password" class="form-input" id="loginPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" value="admin123">
                </div>
                <button type="submit" class="btn btn-primary">Giri≈ü Yap</button>
            </form>
        </div>
    </div>

    <!-- App Container -->
    <div class="app-container" id="appContainer">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-logo">
                <div class="sidebar-logo-icon">üõ°Ô∏è</div>
                <div class="sidebar-logo-text">Super<span>Admin</span></div>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#" data-page="dashboard" class="active">üìä Dashboard</a></li>
                <li><a href="#" data-page="companies">üè¢ Firmalar</a></li>
                <li><a href="#" data-page="stacks">üê≥ Stacks</a></li>
                <li><a href="#" data-page="settings">‚öôÔ∏è Ayarlar</a></li>
            </ul>
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar">SA</div>
                    <div>
                        <div class="user-name">Super Admin</div>
                        <div class="user-role">Platform Y√∂neticisi</div>
                    </div>
                </div>
                <button class="btn btn-secondary" style="width:100%; margin-top:12px;" onclick="logout()">√áƒ±kƒ±≈ü Yap</button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Page -->
            <div class="page active" id="page-dashboard">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Dashboard</h1>
                        <p class="page-subtitle">Platform genel durumu</p>
                    </div>
                    <div>
                        <span class="status-dot active"></span>
                        <span style="color: #22c55e;">Sistem Aktif</span>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Toplam Firma</div>
                            <div class="stat-icon purple-bg">üè¢</div>
                        </div>
                        <div class="stat-value" id="stat-companies">-</div>
                        <div class="stat-desc">Kayƒ±tlƒ± rent a car firmalarƒ±</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Aktif Stack</div>
                            <div class="stat-icon green-bg">üê≥</div>
                        </div>
                        <div class="stat-value" id="stat-stacks">-</div>
                        <div class="stat-desc">Portainer √ºzerinde √ßalƒ±≈üan</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Container</div>
                            <div class="stat-icon blue-bg">üì¶</div>
                        </div>
                        <div class="stat-value" id="stat-containers">-</div>
                        <div class="stat-desc">Toplam container sayƒ±sƒ±</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">
                            <div class="stat-title">Portainer</div>
                            <div class="stat-icon yellow-bg">‚ö°</div>
                        </div>
                        <div class="stat-value" id="stat-portainer">-</div>
                        <div class="stat-desc">Baƒülantƒ± durumu</div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">üöÄ Hƒ±zlƒ± ƒ∞≈ülemler</div>
                    <div style="display: flex; gap: 12px; flex-wrap: wrap;">
                        <button class="btn btn-primary" onclick="showAddCompanyModal()">+ Yeni Firma Ekle</button>
                        <a href="https://72.61.158.147:9443" target="_blank" class="btn btn-secondary">Portainer UI</a>
                        <button class="btn btn-secondary" onclick="refreshData()">üîÑ Yenile</button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">üì° Sistem Bilgileri</div>
                    <table>
                        <tr><td style="color:#94a3b8">Sunucu IP</td><td>72.61.158.147</td></tr>
                        <tr><td style="color:#94a3b8">Frontend Port</td><td>9000</td></tr>
                        <tr><td style="color:#94a3b8">Backend Port</td><td>9001</td></tr>
                        <tr><td style="color:#94a3b8">Portainer Port</td><td>9443</td></tr>
                        <tr><td style="color:#94a3b8">MongoDB Port</td><td>27017</td></tr>
                    </table>
                </div>
            </div>

            <!-- Companies Page -->
            <div class="page" id="page-companies">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Firma Y√∂netimi</h1>
                        <p class="page-subtitle">Rent a car firmalarƒ±nƒ± y√∂netin</p>
                    </div>
                    <button class="btn btn-primary" onclick="showAddCompanyModal()">+ Yeni Firma Ekle</button>
                </div>

                <div class="card">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Firma</th>
                                    <th>Subdomain</th>
                                    <th>Plan</th>
                                    <th>Stack</th>
                                    <th>Durum</th>
                                    <th>ƒ∞≈ülemler</th>
                                </tr>
                            </thead>
                            <tbody id="companiesTable">
                                <tr><td colspan="6" style="text-align:center; color:#94a3b8;">Y√ºkleniyor...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Stacks Page -->
            <div class="page" id="page-stacks">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Docker Stacks</h1>
                        <p class="page-subtitle">Portainer stack y√∂netimi</p>
                    </div>
                    <button class="btn btn-secondary" onclick="loadStacks()">üîÑ Yenile</button>
                </div>

                <div class="card">
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Stack Adƒ±</th>
                                    <th>ID</th>
                                    <th>Durum</th>
                                    <th>ƒ∞≈ülemler</th>
                                </tr>
                            </thead>
                            <tbody id="stacksTable">
                                <tr><td colspan="4" style="text-align:center; color:#94a3b8;">Y√ºkleniyor...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Settings Page -->
            <div class="page" id="page-settings">
                <div class="page-header">
                    <div>
                        <h1 class="page-title">Ayarlar</h1>
                        <p class="page-subtitle">Platform yapƒ±landƒ±rmasƒ±</p>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">üîå Portainer Baƒülantƒ±sƒ±</div>
                    <div class="form-group">
                        <label class="form-label">Portainer URL</label>
                        <input type="text" class="form-input" value="https://72.61.158.147:9443" readonly>
                    </div>
                    <div class="form-group">
                        <label class="form-label">API Key</label>
                        <input type="password" class="form-input" value="ptr_XwtYmxpR0KCkqMLsPLGMM4mHQS5Q75gupgBcCGqRUEY=" readonly>
                    </div>
                    <div style="display:flex;align-items:center;gap:8px;color:#22c55e;">
                        <span class="status-dot active"></span>
                        Baƒülantƒ± aktif
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">üìä Port Aralƒ±klarƒ±</div>
                    <table>
                        <tr><td style="color:#94a3b8">Frontend Portlarƒ±</td><td>10000 - 10999</td></tr>
                        <tr><td style="color:#94a3b8">Backend Portlarƒ±</td><td>11000 - 11999</td></tr>
                        <tr><td style="color:#94a3b8">MongoDB Portlarƒ±</td><td>12000 - 12999</td></tr>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Add Company Modal -->
    <div class="modal-overlay" id="addCompanyModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-title">Yeni Firma Ekle</div>
                <button class="modal-close" onclick="closeModal('addCompanyModal')">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addCompanyForm">
                    <div class="form-group">
                        <label class="form-label">Firma Adƒ± *</label>
                        <input type="text" class="form-input" id="companyName" placeholder="ABC Rent A Car" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Firma Kodu *</label>
                        <input type="text" class="form-input" id="companyCode" placeholder="abc-rentacar" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Subdomain</label>
                        <div style="display:flex;align-items:center;gap:8px;">
                            <input type="text" class="form-input" id="companySubdomain" placeholder="abc" style="max-width:150px;">
                            <span style="color:#94a3b8;">.rentafleet.com</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Admin E-posta</label>
                        <input type="email" class="form-input" id="adminEmail" placeholder="admin@firma.com">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Admin ≈ûifre</label>
                        <input type="password" class="form-input" id="adminPassword" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Plan</label>
                        <select class="form-input" id="companyPlan">
                            <option value="free">Free</option>
                            <option value="starter">Starter</option>
                            <option value="professional">Professional</option>
                            <option value="enterprise">Enterprise</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('addCompanyModal')">ƒ∞ptal</button>
                <button class="btn btn-primary" onclick="addCompany()">Firma Ekle</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        // Configuration
        const API_URL = 'http://72.61.158.147:9001';
        const PORTAINER_URL = 'https://72.61.158.147:9443';
        const PORTAINER_API_KEY = 'ptr_XwtYmxpR0KCkqMLsPLGMM4mHQS5Q75gupgBcCGqRUEY=';

        // State
        let companies = [];
        let stacks = [];

        // Login
        document.getElementById('loginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Simple auth check (in production, use proper authentication)
            if (email && password) {
                localStorage.setItem('superadmin_auth', 'true');
                showApp();
                showToast('Giri≈ü ba≈üarƒ±lƒ±!', 'success');
            }
        });

        function logout() {
            localStorage.removeItem('superadmin_auth');
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('appContainer').classList.remove('active');
        }

        function showApp() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('appContainer').classList.add('active');
            loadDashboard();
        }

        // Check auth on load
        if (localStorage.getItem('superadmin_auth')) {
            showApp();
        }

        // Navigation
        document.querySelectorAll('.sidebar-menu a').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const page = this.dataset.page;
                
                document.querySelectorAll('.sidebar-menu a').forEach(l => l.classList.remove('active'));
                this.classList.add('active');
                
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.getElementById('page-' + page).classList.add('active');
                
                if (page === 'companies') loadCompanies();
                if (page === 'stacks') loadStacks();
                if (page === 'dashboard') loadDashboard();
            });
        });

        // Load Dashboard
        async function loadDashboard() {
            try {
                // Load stacks from Portainer
                const stacksResp = await fetch(PORTAINER_URL + '/api/stacks', {
                    headers: { 'X-API-Key': PORTAINER_API_KEY }
                });
                stacks = await stacksResp.json();
                
                // Load containers
                const containersResp = await fetch(PORTAINER_URL + '/api/endpoints/3/docker/containers/json', {
                    headers: { 'X-API-Key': PORTAINER_API_KEY }
                });
                const containers = await containersResp.json();
                
                document.getElementById('stat-companies').textContent = stacks.length;
                document.getElementById('stat-stacks').textContent = stacks.length;
                document.getElementById('stat-containers').textContent = containers.length;
                document.getElementById('stat-portainer').textContent = '‚úì';
            } catch (e) {
                console.error('Dashboard load error:', e);
                document.getElementById('stat-portainer').textContent = '‚úó';
            }
        }

        // Load Companies
        async function loadCompanies() {
            try {
                const resp = await fetch(PORTAINER_URL + '/api/stacks', {
                    headers: { 'X-API-Key': PORTAINER_API_KEY }
                });
                stacks = await resp.json();
                
                const tbody = document.getElementById('companiesTable');
                if (stacks.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center; color:#94a3b8;">Hen√ºz firma yok</td></tr>';
                    return;
                }
                
                tbody.innerHTML = stacks.map(stack => `
                    <tr>
                        <td>
                            <div style="font-weight:500;">${stack.Name}</div>
                            <div style="font-size:12px;color:#94a3b8;">ID: ${stack.Id}</div>
                        </td>
                        <td><code style="color:#a78bfa;">${stack.Name.replace('rentacar_', '')}</code></td>
                        <td><span class="badge badge-info">Starter</span></td>
                        <td><span class="badge badge-success">Stack #${stack.Id}</span></td>
                        <td><span class="badge badge-success"><span class="status-dot active"></span>Aktif</span></td>
                        <td>
                            <button class="btn btn-sm btn-danger" onclick="deleteStack(${stack.Id}, '${stack.Name}')">Sil</button>
                        </td>
                    </tr>
                `).join('');
            } catch (e) {
                console.error('Companies load error:', e);
                document.getElementById('companiesTable').innerHTML = '<tr><td colspan="6" style="text-align:center; color:#ef4444;">Y√ºkleme hatasƒ±</td></tr>';
            }
        }

        // Load Stacks
        async function loadStacks() {
            try {
                const resp = await fetch(PORTAINER_URL + '/api/stacks', {
                    headers: { 'X-API-Key': PORTAINER_API_KEY }
                });
                stacks = await resp.json();
                
                const tbody = document.getElementById('stacksTable');
                if (stacks.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; color:#94a3b8;">Hen√ºz stack yok</td></tr>';
                    return;
                }
                
                tbody.innerHTML = stacks.map(stack => `
                    <tr>
                        <td><strong>${stack.Name}</strong></td>
                        <td>${stack.Id}</td>
                        <td><span class="badge badge-success">Running</span></td>
                        <td>
                            <a href="${PORTAINER_URL}/#/stacks/${stack.Name}" target="_blank" class="btn btn-sm btn-secondary">Portainer'da A√ß</a>
                            <button class="btn btn-sm btn-danger" onclick="deleteStack(${stack.Id}, '${stack.Name}')">Sil</button>
                        </td>
                    </tr>
                `).join('');
            } catch (e) {
                console.error('Stacks load error:', e);
            }
        }

        // Add Company
        async function addCompany() {
            const name = document.getElementById('companyName').value;
            const code = document.getElementById('companyCode').value;
            
            if (!name || !code) {
                showToast('Firma adƒ± ve kodu zorunludur', 'error');
                return;
            }
            
            showToast('Firma olu≈üturuluyor...', 'success');
            closeModal('addCompanyModal');
            
            // In production, this would call your backend API to create the company and deploy to Portainer
            // For now, show success message
            setTimeout(() => {
                showToast('Firma ba≈üarƒ±yla olu≈üturuldu! Portainer\'da deploy etmek i√ßin backend API\'yi kullanƒ±n.', 'success');
                loadCompanies();
            }, 1000);
        }

        // Delete Stack
        async function deleteStack(stackId, stackName) {
            if (!confirm(`"${stackName}" stack'ini silmek istediƒüinize emin misiniz?`)) return;
            
            try {
                await fetch(`${PORTAINER_URL}/api/stacks/${stackId}?endpointId=3`, {
                    method: 'DELETE',
                    headers: { 'X-API-Key': PORTAINER_API_KEY }
                });
                showToast('Stack silindi', 'success');
                loadStacks();
                loadCompanies();
                loadDashboard();
            } catch (e) {
                showToast('Silme hatasƒ±: ' + e.message, 'error');
            }
        }

        // Modals
        function showAddCompanyModal() {
            document.getElementById('addCompanyModal').classList.add('active');
        }

        function closeModal(id) {
            document.getElementById(id).classList.remove('active');
        }

        // Toast
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.innerHTML = `<span>${type === 'success' ? '‚úì' : '‚úó'}</span> ${message}`;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // Refresh
        function refreshData() {
            loadDashboard();
            showToast('Veriler yenilendi', 'success');
        }

        // Close modal on overlay click
        document.querySelectorAll('.modal-overlay').forEach(overlay => {
            overlay.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>
